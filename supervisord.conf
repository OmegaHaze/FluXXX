[supervisord]
nodaemon=true
logfile=/workspace/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
pidfile=/var/run/supervisord.pid
childlogdir=/workspace/logs

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0777

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[program:ollama]
command=/usr/local/bin/ollama serve
autostart=true
autorestart=true
startsecs=5
stderr_logfile=/workspace/logs/ollama.err.log
stdout_logfile=/workspace/logs/ollama.log

[program:comfyui]
command=python3 /workspace/ComfyUI/main.py --port 8188 --listen 0.0.0.0
autostart=true
autorestart=true
startsecs=10
stderr_logfile=/workspace/logs/comfyui.err.log
stdout_logfile=/workspace/logs/comfyui.log

[program:openwebui_frontend]
command=bash -c 'npm start -- --port 7500 --host 0.0.0.0'
directory=/workspace/open-webui
environment=OLLAMA_API_BASE_URL=http://localhost:11434/api,OLLAMA_HOST=http://localhost:11434
autostart=true
autorestart=true
startsecs=15
stderr_logfile=/workspace/logs/openwebui_frontend.err.log
stdout_logfile=/workspace/logs/openwebui_frontend.log

[program:openwebui_backend]
command=bash -c 'cd /workspace/open-webui/backend && exec uvicorn open_webui.main:app --host 0.0.0.0 --port 7500 --forwarded-allow-ips "*"'
directory=/workspace/open-webui/backend
autostart=true
autorestart=true
startsecs=15
stderr_logfile=/workspace/logs/openwebui_backend.err.log
stdout_logfile=/workspace/logs/openwebui_backend.log
environment=PYTHONUNBUFFERED=true
